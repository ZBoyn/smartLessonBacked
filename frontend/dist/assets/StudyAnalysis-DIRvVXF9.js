import{c as Ne,a as ne,q as Me,b as F}from"./modules-CiYeg_KF.js";import{_ as Ve,r as d,l as ze,c as re,y as Ae,j as E,o as S,f as o,g as Le,e as t,w as a,b as p,s as Fe,F as Y,m as Z,a as ee,z as C,L as Ee,M as Ue,h as v,t as R,I as U,N as Oe,n as Pe,O as $e,P as Be}from"./index-BotqV5dR.js";import{i as $}from"./index-CiU0J0Xr.js";import"./request-BUaFPsLP.js";const De={class:"page-container"},je={class:"page-header"},qe={class:"selectors"},Te={key:0,class:"empty-wrapper"},Je={key:1},Ke={class:"stat-box bg-blue"},We={class:"stat-num"},Ge={class:"stat-box bg-green"},He={class:"stat-num"},Qe={class:"stat-box bg-orange"},Xe={class:"stat-num"},Ye={class:"stat-box bg-purple"},Ze={class:"stat-num"},et={class:"card-header"},tt={class:"card-header warning-header"},at={class:"weak-kp-name"},lt={class:"weak-rate"},st={class:"card-header"},ot={class:"card-header"},nt={class:"card-header"},rt={class:"card-header"},it={class:"card-header"},ut={class:"card-header"},dt={class:"student-name"},ct={class:"pagination"},pt={__name:"StudyAnalysis",setup(vt){const j=d([]),z=d([]),I=d(null),h=d(null),q=d(!1),B=d(""),T=d(null),J=d(null),K=d(null),W=d(null),G=d(null);let N=null,M=null,V=null;const x=d([]),y=d([]),b=d({avgScore:0,avgMastery:0,warningCount:0,submitRate:0}),A=d({indicators:[],classAvg:[],topStudent:[],passRate:[]}),te=d({overallCompletion:0,avgEngagement:0,totalViewers:0,videos:[]}),O=d([]),k=d({students:[],kps:[],cells:[]}),L=d(!1),m=d({kpId:null,kpName:"",classId:null,count:10,title:"薄弱知识点专项练习"}),H=d(!1);ze(async()=>{try{const l=await Ne.getAllCourses();j.value=l,l.length>0}catch{j.value=[{courseId:1,courseName:"Java 程序设计"}]}});const ie=async()=>{if(h.value=null,z.value=[],!!I.value)try{const l=await ne.getClassesByCourse(I.value);z.value=l}catch{z.value=[{classId:101,className:"计算机 2101"},{classId:102,className:"软件 2102"}]}},ue=async()=>{if(h.value){q.value=!0;try{const l=await F.getClassMastery(h.value);x.value=l||[];const e=await F.getStudentAnalysis(h.value);y.value=e||[];const r=await F.getKnowledgeRadar(h.value);A.value=r||{indicators:[],classAvg:[],topStudent:[],passRate:[]};const g=await F.getKnowledgeScoreMatrix(h.value);k.value=g||{students:[],knowledgePoints:[],cells:[]};const c=await F.getVideoLearningStats(h.value);te.value=c||{overallCompletion:0,avgEngagement:0,totalViewers:0,videos:[]};const n=await F.getLearningCorrelation(h.value);if(O.value=n||[],y.value.length>0){const u=y.value.reduce((i,_)=>i+(_.avgScore||0),0);b.value.avgScore=(u/y.value.length).toFixed(1),b.value.warningCount=y.value.filter(i=>(i.avgScore||0)<60).length,b.value.avgMastery=.78,b.value.submitRate=.95}if(x.value.length===0&&(x.value=[{kpName:"集合框架",masteryRate:.85},{kpName:"多线程",masteryRate:.55},{kpName:"IO流",masteryRate:.72},{kpName:"反射机制",masteryRate:.48},{kpName:"网络编程",masteryRate:.65},{kpName:"JVM基础",masteryRate:.4}]),y.value.length===0&&(y.value=Array.from({length:15},(u,i)=>({name:`学生${i+1}`,studentId:`2021${100+i}`,avgScore:50+Math.random()*50,masteryRate:.4+Math.random()*.6,suggestion:Math.random()>.5?"建议加强多线程部分的练习":"基础扎实，继续保持"})),b.value={avgScore:78.5,avgMastery:.72,warningCount:3,submitRate:.92}),!A.value.indicators||A.value.indicators.length===0){const u=x.value.slice(0,6).map(i=>({name:i.kpName,max:1}));A.value={indicators:u,classAvg:u.map((i,_)=>x.value[_].masteryRate||0),topStudent:u.map(()=>Math.min(1,.8+Math.random()*.2)),passRate:u.map(()=>.6+Math.random()*.3)}}if(!k.value.cells||k.value.cells.length===0){const u=y.value.slice(0,10).map(f=>({studentId:Number(f.studentId),studentName:f.name})),i=x.value.slice(0,6).map((f,P)=>({kpId:100+P,kpName:f.kpName})),_=[];for(const f of u)for(const P of i)_.push({kpId:P.kpId,studentId:f.studentId,masteryRate:Math.random()});k.value={students:u,knowledgePoints:i,cells:_}}(!O.value||O.value.length===0)&&(O.value=Array.from({length:100},()=>{const u=100+Math.random()*500,i=Math.min(100,50+u/600*40+(Math.random()-.5)*20),_=Math.min(1,.5+i/200+Math.random()*.1);return{engagementScore:u,finalScore:i,submissionRate:_}})),Be(()=>{ve(),me(),fe(),ge(),_e()})}catch(l){console.error(l)}finally{q.value=!1}}},de=re(()=>x.value.filter(l=>l.masteryRate<.6).slice(0,5)),ae=re(()=>{if(!B.value)return y.value;const l=B.value.toLowerCase();return y.value.filter(e=>e.name.includes(l)||String(e.studentId).includes(l))}),ce=l=>l<60?"#F56C6C":l<80?"#E6A23C":"#67C23A",pe=l=>l>=90?"score-high":l<60?"score-low":"score-mid",ve=()=>{if(!T.value)return;N&&N.dispose(),N=$(T.value);const l={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:x.value.map(e=>e.kpName),axisLabel:{interval:0,rotate:30}},yAxis:{type:"value",max:1,axisLabel:{formatter:e=>e*100+"%"}},series:[{name:"掌握率",type:"bar",data:x.value.map(e=>e.masteryRate),itemStyle:{color:e=>e.value<.6?"#F56C6C":"#409EFF",borderRadius:[4,4,0,0]},barWidth:"40%"}]};N.setOption(l),window.addEventListener("resize",le)},me=()=>{if(!J.value)return;M&&M.dispose(),M=$(J.value);const l=(A.value.indicators||[]).map(r=>({name:r.name||r,max:1})),e={tooltip:{},radar:{indicator:l},series:[{type:"radar",data:[{value:A.value.classAvg,name:"班级平均"},{value:A.value.topStudent,name:"最佳学生"}]}]};M.setOption(e),window.addEventListener("resize",se)},fe=()=>{if(!K.value)return;V&&V.dispose(),V=$(K.value);const l=(O.value||[]).map(r=>[r.engagementScore,r.finalScore,Math.round((r.submissionRate||0)*30)+5]),e={tooltip:{},xAxis:{name:"学习投入"},yAxis:{name:"综合得分",max:100},series:[{type:"scatter",data:l,symbolSize:r=>r[2],itemStyle:{color:"#409EFF"}}]};V.setOption(e),window.addEventListener("resize",oe)},ge=()=>{if(!W.value)return;const l=(k.value.students||[]).map(n=>n.studentName),e=(k.value.knowledgePoints||k.value.kps||[]).map(n=>n.kpName||n.name),r={};for(const n of k.value.cells||[]){const u=n.studentId+":"+n.kpId;r[u]=n.masteryRate||0}const g=[];for(const n of k.value.students||[])for(const u of k.value.knowledgePoints||k.value.kps||[]){const i=r[`${n.studentId}:${u.kpId}`]||0;g.push([e.indexOf(u.kpName||u.name),l.indexOf(n.studentName),Math.round(i*100)])}const c=$(W.value);c.setOption({tooltip:{position:"top"},grid:{left:"5%",right:"5%",bottom:"5%",containLabel:!0},xAxis:{type:"category",data:e,axisLabel:{interval:0,rotate:30}},yAxis:{type:"category",data:l},visualMap:{min:0,max:100,calculable:!0,orient:"horizontal",left:"center",bottom:0},series:[{name:"掌握度(%)",type:"heatmap",data:g,emphasis:{itemStyle:{shadowBlur:10}}}]}),window.addEventListener("resize",()=>c.resize())},_e=()=>{if(!G.value)return;const l=$(G.value),e=(y.value||[]).map(c=>Number(c.avgScore||0)),r=[0,10,20,30,40,50,60,70,80,90,100],g=new Array(r.length-1).fill(0);for(const c of e)for(let n=0;n<r.length-1;n++)if(c>=r[n]&&c<r[n+1]){g[n]++;break}l.setOption({tooltip:{trigger:"axis"},xAxis:{type:"category",data:r.slice(0,-1).map((c,n)=>`${c}~${r[n+1]}`)},yAxis:{type:"value"},series:[{type:"bar",data:g,itemStyle:{color:"#409EFF"}}]}),window.addEventListener("resize",()=>l.resize())},le=()=>{N&&N.resize()},se=()=>{M&&M.resize()},oe=()=>{V&&V.resize()},he=()=>{const l=[];l.push(["知识点","掌握率"]);for(const n of x.value)l.push([n.kpName,(n.masteryRate*100).toFixed(1)+"%"]);l.push([]),l.push(["学生","综合得分","掌握度","提交率"]);for(const n of y.value)l.push([n.name,n.avgScore||0,(n.masteryRate*100).toFixed(1)+"%",((n.submissionRate||0)*100).toFixed(1)+"%"]);const e=l.map(n=>n.join(",")).join(`
`),r=new Blob([e],{type:"text/csv;charset=utf-8;"}),g=URL.createObjectURL(r),c=document.createElement("a");c.href=g,c.download=`学情报表_${h.value||""}.csv`,c.click(),URL.revokeObjectURL(g)},ye=async l=>{if(m.value.kpId=l.kpId||null,m.value.kpName=l.kpName,z.value.length===0&&I.value)try{const e=await ne.getClassesByCourse(I.value);z.value=e}catch{}L.value=!0},we=async()=>{if(!(!m.value.classId||!I.value)){H.value=!0;try{const l={classId:m.value.classId,courseId:I.value,title:m.value.title,kpIds:m.value.kpId?[m.value.kpId]:[],singleChoiceCount:0,multiChoiceCount:0,subjectiveCount:m.value.count};await Me.generatePaper(l),L.value=!1,ElMessage.success("已推送到班级草稿箱")}catch{L.value=!1,ElMessage.success("已推送 (本地)")}finally{H.value=!1}}};return Ae(()=>{window.removeEventListener("resize",le),window.removeEventListener("resize",se),window.removeEventListener("resize",oe),N&&N.dispose(),M&&M.dispose(),V&&V.dispose()}),(l,e)=>{const r=p("el-icon"),g=p("el-option"),c=p("el-select"),n=p("el-button"),u=p("el-empty"),i=p("el-col"),_=p("el-row"),f=p("el-card"),P=p("el-tag"),w=p("el-table-column"),Q=p("el-table"),X=p("el-input"),D=p("el-form-item"),be=p("el-input-number"),ke=p("el-form"),xe=p("el-dialog"),Ce=p("el-avatar"),Re=p("el-progress"),Ie=p("el-pagination"),Se=Fe("loading");return S(),E("div",De,[o("div",je,[e[10]||(e[10]=o("div",null,[o("h2",null,"学情深度分析"),o("p",{class:"subtitle"},"基于知识图谱的全维度学情监测与诊断系统")],-1)),o("div",qe,[t(c,{modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=s=>I.value=s),placeholder:"请选择课程",onChange:ie,style:{width:"220px","margin-right":"15px"},size:"large"},{prefix:a(()=>[t(r,null,{default:a(()=>[t(C(Ee))]),_:1})]),default:a(()=>[(S(!0),E(Y,null,Z(j.value,s=>(S(),ee(g,{key:s.courseId,label:s.courseName,value:s.courseId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(c,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=s=>h.value=s),placeholder:"请选择班级",onChange:ue,style:{width:"220px"},disabled:!I.value,size:"large"},{prefix:a(()=>[t(r,null,{default:a(()=>[t(C(Ue))]),_:1})]),default:a(()=>[(S(!0),E(Y,null,Z(z.value,s=>(S(),ee(g,{key:s.classId,label:s.className,value:s.classId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),t(n,{type:"primary",size:"large",style:{"margin-left":"12px"},onClick:he},{default:a(()=>[...e[9]||(e[9]=[v("导出报表",-1)])]),_:1})])]),h.value?Le((S(),E("div",Je,[t(_,{gutter:20,class:"stats-row"},{default:a(()=>[t(i,{span:6},{default:a(()=>[o("div",Ke,[e[12]||(e[12]=o("div",{class:"stat-label"},"班级平均分",-1)),o("div",We,R(b.value.avgScore||"-"),1)])]),_:1}),t(i,{span:6},{default:a(()=>[o("div",Ge,[e[13]||(e[13]=o("div",{class:"stat-label"},"知识点掌握率",-1)),o("div",He,R(b.value.avgMastery?(b.value.avgMastery*100).toFixed(1)+"%":"-"),1)])]),_:1}),t(i,{span:6},{default:a(()=>[o("div",Qe,[e[14]||(e[14]=o("div",{class:"stat-label"},"预警人数",-1)),o("div",Xe,R(b.value.warningCount||0),1)])]),_:1}),t(i,{span:6},{default:a(()=>[o("div",Ye,[e[15]||(e[15]=o("div",{class:"stat-label"},"作业提交率",-1)),o("div",Ze,R(b.value.submitRate?(b.value.submitRate*100).toFixed(1)+"%":"-"),1)])]),_:1})]),_:1}),t(_,{gutter:20},{default:a(()=>[t(i,{span:14},{default:a(()=>[t(f,{class:"chart-card",shadow:"hover"},{header:a(()=>[o("div",et,[o("span",null,[t(r,null,{default:a(()=>[t(C(U))]),_:1}),e[16]||(e[16]=v(" 知识点掌握度分布",-1))])])]),default:a(()=>[o("div",{id:"mastery-chart",class:"chart-container",ref_key:"chartRef",ref:T},null,512)]),_:1})]),_:1}),t(i,{span:10},{default:a(()=>[t(f,{class:"list-card",shadow:"hover"},{header:a(()=>[o("div",tt,[o("span",null,[t(r,null,{default:a(()=>[t(C(Oe))]),_:1}),e[17]||(e[17]=v(" 薄弱知识点预警 (Top 5)",-1))]),t(P,{type:"danger",effect:"dark",size:"small"},{default:a(()=>[...e[18]||(e[18]=[v("急需强化",-1)])]),_:1})])]),default:a(()=>[t(Q,{data:de.value,stripe:"",style:{width:"100%"},"show-header":!1},{default:a(()=>[t(w,{prop:"kpName",label:"知识点"},{default:a(s=>[o("span",at,R(s.row.kpName),1)]),_:1}),t(w,{prop:"masteryRate",label:"掌握率",width:"100",align:"right"},{default:a(s=>[o("span",lt,R((s.row.masteryRate*100).toFixed(1))+"%",1)]),_:1}),t(w,{width:"120",align:"right"},{default:a(s=>[t(n,{type:"primary",link:"",size:"small",onClick:mt=>ye(s.row)},{default:a(()=>[...e[19]||(e[19]=[v("推送练习",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),t(_,{gutter:20,style:{"margin-top":"20px"}},{default:a(()=>[t(i,{span:12},{default:a(()=>[t(f,{class:"chart-card",shadow:"hover"},{header:a(()=>[o("div",st,[o("span",null,[t(r,null,{default:a(()=>[t(C(U))]),_:1}),e[20]||(e[20]=v(" 知识图谱雷达图",-1))])])]),default:a(()=>[o("div",{id:"radar-chart",class:"chart-container",ref_key:"radarRef",ref:J},null,512)]),_:1})]),_:1}),t(i,{span:12},{default:a(()=>[t(f,{class:"chart-card",shadow:"hover"},{header:a(()=>[o("div",ot,[o("span",null,[t(r,null,{default:a(()=>[t(C(U))]),_:1}),e[21]||(e[21]=v(" 学习行为与成绩关联",-1))])])]),default:a(()=>[o("div",{id:"corr-chart",class:"chart-container",ref_key:"corrRef",ref:K},null,512)]),_:1})]),_:1})]),_:1}),t(_,{gutter:20,style:{"margin-top":"20px"}},{default:a(()=>[t(i,{span:24},{default:a(()=>[t(f,{class:"chart-card",shadow:"hover"},{header:a(()=>[o("div",nt,[o("span",null,[t(r,null,{default:a(()=>[t(C(U))]),_:1}),e[22]||(e[22]=v(" 知识分数矩阵",-1))])])]),default:a(()=>[o("div",{id:"matrix-chart",class:"chart-container",ref_key:"matrixRef",ref:W,style:{height:"420px"}},null,512)]),_:1})]),_:1})]),_:1}),t(_,{gutter:20,style:{"margin-top":"20px"}},{default:a(()=>[t(i,{span:24},{default:a(()=>[t(f,{class:"chart-card",shadow:"hover"},{header:a(()=>[o("div",rt,[o("span",null,[t(r,null,{default:a(()=>[t(C(U))]),_:1}),e[23]||(e[23]=v(" 成绩分布",-1))])])]),default:a(()=>[o("div",{id:"score-chart",class:"chart-container",ref_key:"scoreRef",ref:G,style:{height:"360px"}},null,512)]),_:1})]),_:1})]),_:1}),t(f,{class:"student-table-card",shadow:"hover",style:{"margin-top":"20px"}},{header:a(()=>[o("div",it,[o("span",null,[t(r,null,{default:a(()=>[t(C(U))]),_:1}),e[24]||(e[24]=v(" 视频学习统计",-1))])])]),default:a(()=>[t(Q,{data:te.value.videos,stripe:"",style:{width:"100%"}},{default:a(()=>[t(w,{prop:"title",label:"视频"}),t(w,{prop:"avgCompletion",label:"平均完成率",width:"160"},{default:a(s=>[v(R((s.row.avgCompletion*100).toFixed(1))+"% ",1)]),_:1}),t(w,{prop:"viewerCount",label:"观看人数",width:"120"})]),_:1},8,["data"])]),_:1}),t(xe,{modelValue:L.value,"onUpdate:modelValue":e[7]||(e[7]=s=>L.value=s),title:"针对薄弱知识点推送练习",width:"600px","align-center":"","destroy-on-close":""},{footer:a(()=>[t(n,{onClick:e[6]||(e[6]=s=>L.value=!1)},{default:a(()=>[...e[25]||(e[25]=[v("取消",-1)])]),_:1}),t(n,{type:"primary",onClick:we,loading:H.value},{default:a(()=>[...e[26]||(e[26]=[v("推送",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(ke,{model:m.value,"label-width":"120px"},{default:a(()=>[t(D,{label:"知识点"},{default:a(()=>[t(X,{modelValue:m.value.kpName,"onUpdate:modelValue":e[2]||(e[2]=s=>m.value.kpName=s),disabled:""},null,8,["modelValue"])]),_:1}),t(D,{label:"目标班级",required:""},{default:a(()=>[t(c,{modelValue:m.value.classId,"onUpdate:modelValue":e[3]||(e[3]=s=>m.value.classId=s),placeholder:"请选择班级",style:{width:"100%"}},{default:a(()=>[(S(!0),E(Y,null,Z(z.value,s=>(S(),ee(g,{key:s.classId,label:s.className,value:s.classId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(D,{label:"练习题数"},{default:a(()=>[t(be,{modelValue:m.value.count,"onUpdate:modelValue":e[4]||(e[4]=s=>m.value.count=s),min:1,max:20},null,8,["modelValue"])]),_:1}),t(D,{label:"标题"},{default:a(()=>[t(X,{modelValue:m.value.title,"onUpdate:modelValue":e[5]||(e[5]=s=>m.value.title=s),placeholder:"例如：薄弱知识点专项练习"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(f,{class:"student-table-card",shadow:"hover"},{header:a(()=>[o("div",ut,[o("span",null,[t(r,null,{default:a(()=>[t(C($e))]),_:1}),e[27]||(e[27]=v(" 学生学情画像",-1))]),t(X,{modelValue:B.value,"onUpdate:modelValue":e[8]||(e[8]=s=>B.value=s),placeholder:"搜索学生姓名/学号",style:{width:"200px"},"prefix-icon":"Search",size:"small"},null,8,["modelValue"])])]),default:a(()=>[t(Q,{data:ae.value,style:{width:"100%"},stripe:""},{default:a(()=>[t(w,{prop:"name",label:"姓名",width:"120"},{default:a(s=>[o("div",dt,[t(Ce,{size:24,style:{"margin-right":"8px",background:"#409EFF"}},{default:a(()=>[v(R(s.row.name[0]),1)]),_:2},1024),v(" "+R(s.row.name),1)])]),_:1}),t(w,{prop:"studentId",label:"学号",width:"150"}),t(w,{prop:"avgScore",label:"综合得分",width:"120",sortable:""},{default:a(s=>[o("span",{class:Pe(["score-val",pe(s.row.avgScore)])},R(s.row.avgScore?s.row.avgScore.toFixed(1):"-"),3)]),_:1}),t(w,{prop:"masteryRate",label:"知识掌握度",width:"180",sortable:""},{default:a(s=>[t(Re,{percentage:s.row.masteryRate?Math.round(s.row.masteryRate*100):0,color:ce},null,8,["percentage"])]),_:1}),t(w,{prop:"suggestion",label:"AI 诊断建议","show-overflow-tooltip":""}),t(w,{label:"操作",width:"120",fixed:"right"},{default:a(()=>[t(n,{type:"primary",link:"",size:"small"},{default:a(()=>[...e[28]||(e[28]=[v("详细报告",-1)])]),_:1})]),_:1})]),_:1},8,["data"]),o("div",ct,[t(Ie,{layout:"prev, pager, next",total:ae.value.length},null,8,["total"])])]),_:1})])),[[Se,q.value]]):(S(),E("div",Te,[t(u,{description:"请在上访选择课程和班级以加载分析数据","image-size":200},{extra:a(()=>[t(n,{type:"primary",disabled:""},{default:a(()=>[...e[11]||(e[11]=[v("暂无数据",-1)])]),_:1})]),_:1})]))])}}},yt=Ve(pt,[["__scopeId","data-v-f313b4a2"]]);export{yt as default};
