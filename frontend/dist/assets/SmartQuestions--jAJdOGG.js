import{_ as ze,u as Ge,r as p,p as Ne,c as W,l as Pe,j as T,o as c,f as n,e as l,w as t,b as u,s as Le,h as r,z as U,C as Be,t as m,D as Oe,g as Re,a as _,G as ue,H as $e,q as y,F as ie,m as de,I as je,E as b}from"./index-BotqV5dR.js";import{q as A,g as Fe,a as He}from"./modules-CiYeg_KF.js";import"./request-BUaFPsLP.js";const Ye={class:"page-container"},Je={class:"page-header"},Ke={class:"header-actions"},We={class:"card-header"},Xe={class:"filter-tree-container"},Ze={class:"custom-tree-node"},el={style:{"margin-left":"8px"}},ll={class:"custom-tab-label"},tl={class:"table-toolbar"},al={class:"question-preview"},ol={class:"pagination-container"},sl={class:"custom-tab-label"},nl={key:0,class:"options-block"},ul={class:"option-index"},il={class:"dialog-footer"},dl={class:"step-content"},rl={class:"count-settings"},pl={class:"count-card"},cl={class:"count-card"},ml={class:"count-card"},fl={key:2,class:"preview-container"},vl={class:"paper-preview-card"},_l={class:"paper-meta"},yl={class:"strategy-summary"},gl={class:"dialog-footer"},bl={__name:"SmartQuestions",setup(Vl){const w=Ge().params.courseId,D=p("list"),h=p([]),M=p([]),L=p(!1),S=p(""),E=p(""),B=p(""),X=p(null),re={children:"children",label:"label"},Q=p([]),z=p(null);Ne(B,o=>{X.value.filter(o)});const pe=(o,e)=>o?e.label.includes(o):!0,Z=W(()=>{let o=Q.value;return S.value&&(o=o.filter(e=>e.prompt.includes(S.value))),E.value&&(o=o.filter(e=>e.questionType===E.value)),o}),I=p(!1),O=p(!1),s=p({questionType:"single_choice",prompt:"",difficultyLevel:2,kpIds:[],supportsAiGrading:!0,options:[{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1}],correctOptionIndex:0}),ee=W(()=>{const o=(s.value.prompt||"").length;return o>120?"困难":o>60?"中等":o>0?"简单":""}),ce=()=>{I.value=!0,h.value.length===0&&j(),z.value=null},me=()=>{s.value.options.push({text:"",isCorrect:!1})},fe=o=>{s.value.options.splice(o,1)},ve=async()=>{if(!s.value.prompt){b.warning("请输入题干内容");return}O.value=!0;try{const o={1:"EASY",2:"MEDIUM",3:"HARD"},e={courseId:parseInt(w),prompt:s.value.prompt,questionType:s.value.questionType,difficulty:o[s.value.difficultyLevel],supportsAiGrading:s.value.supportsAiGrading,knowledgePointIds:s.value.kpIds,options:[]};s.value.questionType==="single_choice"&&(e.options=s.value.options.map((d,v)=>({optionText:d.text,isCorrect:v===s.value.correctOptionIndex}))),z.value?(await A.updateQuestion(z.value,e),b.success("题目更新成功")):(await A.createQuestion(e),b.success("题目录入成功")),I.value=!1,$()}catch(o){console.error(o),b.error("操作失败: "+(o.message||"未知错误"))}finally{O.value=!1}},_e=o=>({single_choice:"单选题",report:"报告题",short_answer:"简答题",multi_choice:"多选题"})[o]||o,ye=o=>({single_choice:"primary",report:"warning",short_answer:"success"})[o]||"info",q=p(!1),f=p(0),R=p(!1),i=p({title:"",classId:null,kpIds:[],difficulty:3,singleChoiceCount:10,multiChoiceCount:5,subjectiveCount:2}),le=W(()=>(i.value.singleChoiceCount||0)+(i.value.multiChoiceCount||0)+(i.value.subjectiveCount||0)),$=async()=>{if(w){L.value=!0;try{const o=await A.getQuestionsByCourse(w),e={EASY:1,MEDIUM:2,HARD:3};Q.value=o.map(d=>({...d,difficultyVal:e[d.difficulty]||2}))}catch{Q.value=[{questionType:"single_choice",prompt:"Java中HashMap的扩容因子默认是多少？",difficultyVal:2},{questionType:"short_answer",prompt:"简述Spring Boot的自动配置原理。",difficultyVal:3},{questionType:"report",prompt:"请提交本次实验的实验报告。",difficultyVal:1}]}finally{L.value=!1}}},j=async()=>{if(w)try{const o=await Fe.getGraph(w);o&&o.nodes?h.value=o.nodes.map(e=>({id:e.kpId,label:e.name,children:[]})):h.value=[]}catch{h.value=[{id:1,label:"Java基础",children:[]},{id:2,label:"集合框架",children:[]},{id:3,label:"多线程",children:[]}]}},ge=async()=>{if(w)try{const o=await He.getClassesByCourse(w);M.value=o}catch{M.value=[{classId:101,className:"计算机科学与技术1班"},{classId:102,className:"软件工程2班"}]}},be=()=>{f.value=0,q.value=!0,h.value.length===0&&j(),M.value.length===0&&ge()},Ve=async()=>{if(!i.value.title||!i.value.classId){b.warning("请完善试卷基本信息");return}R.value=!0;try{await A.generatePaper({...i.value,courseId:w}),b.success("试卷生成成功！已存入草稿箱"),q.value=!1,D.value="papers"}catch{b.success("试卷生成成功 (Mock)"),q.value=!1,D.value="papers"}finally{R.value=!1}},Ce=o=>{},we=async o=>{try{const e=await A.getQuestionById(o.questionId);s.value.questionType=e.questionType,s.value.prompt=e.prompt;const d={EASY:1,MEDIUM:2,HARD:3};if(s.value.difficultyLevel=d[e.difficulty]||2,s.value.kpIds=e.knowledgePointIds||[],s.value.supportsAiGrading=e.supportsAiGrading,e.questionType==="single_choice"){s.value.options=(e.options||[]).map(g=>({text:g.optionText,isCorrect:g.isCorrect}));const v=(e.options||[]).findIndex(g=>g.isCorrect);s.value.correctOptionIndex=v>=0?v:0}else s.value.options=[{text:"",isCorrect:!1},{text:"",isCorrect:!1}],s.value.correctOptionIndex=0;z.value=e.questionId,I.value=!0}catch{b.error("获取题目失败")}},he=async o=>{try{await A.deleteQuestion(o.questionId),b.success("已删除"),$()}catch{b.success("已删除 (本地)"),Q.value=Q.value.filter(d=>d!==o)}};return Pe(()=>{$(),j()}),(o,e)=>{const d=u("el-button"),v=u("el-icon"),g=u("el-input"),xe=u("el-tree"),te=u("el-card"),x=u("el-col"),k=u("el-option"),F=u("el-select"),G=u("el-tag"),N=u("el-table-column"),ae=u("el-rate"),ke=u("el-table"),Ie=u("el-pagination"),oe=u("el-tab-pane"),qe=u("el-empty"),Te=u("el-tabs"),H=u("el-row"),V=u("el-form-item"),se=u("el-cascader"),Ue=u("el-radio"),Ae=u("el-switch"),Y=u("el-form"),ne=u("el-dialog"),J=u("el-step"),Qe=u("el-steps"),De=u("el-slider"),K=u("el-input-number"),Me=u("el-divider"),Se=u("el-alert"),Ee=Le("loading");return c(),T("div",Ye,[n("div",Je,[e[25]||(e[25]=n("div",null,[n("h2",null,"智能题库管理"),n("p",{class:"subtitle"},"基于知识图谱的题目管理与自动组卷系统")],-1)),n("div",Ke,[l(d,{type:"primary",icon:"Plus",size:"large",onClick:ce},{default:t(()=>[...e[23]||(e[23]=[r("录入试题",-1)])]),_:1}),l(d,{type:"success",icon:"MagicStick",size:"large",onClick:be},{default:t(()=>[...e[24]||(e[24]=[r("智能组卷",-1)])]),_:1})])]),l(H,{gutter:24},{default:t(()=>[l(x,{span:5},{default:t(()=>[l(te,{class:"filter-card",shadow:"hover"},{header:t(()=>[n("div",We,[l(v,null,{default:t(()=>[l(U(Oe))]),_:1}),e[26]||(e[26]=n("span",null,"知识点筛选",-1))])]),default:t(()=>[n("div",Xe,[l(g,{modelValue:B.value,"onUpdate:modelValue":e[0]||(e[0]=a=>B.value=a),placeholder:"搜索知识点","prefix-icon":"Search",clearable:"",style:{"margin-bottom":"15px"}},null,8,["modelValue"]),l(xe,{ref_key:"treeRef",ref:X,data:h.value,props:re,"filter-node-method":pe,"node-key":"id","highlight-current":"",onNodeClick:Ce,"empty-text":"暂无知识点数据"},{default:t(({node:a,data:C})=>[n("span",Ze,[l(v,null,{default:t(()=>[l(U(Be))]),_:1}),n("span",el,m(a.label),1)])]),_:1},8,["data"])])]),_:1})]),_:1}),l(x,{span:19},{default:t(()=>[l(te,{shadow:"never",class:"main-content-card"},{default:t(()=>[l(Te,{modelValue:D.value,"onUpdate:modelValue":e[3]||(e[3]=a=>D.value=a),class:"custom-tabs"},{default:t(()=>[l(oe,{name:"list"},{label:t(()=>[n("span",ll,[l(v,null,{default:t(()=>[l(U(ue))]),_:1}),e[27]||(e[27]=r(" 题目列表 ",-1))])]),default:t(()=>[n("div",tl,[l(g,{modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=a=>S.value=a),placeholder:"搜索题目内容...",style:{width:"300px"},"prefix-icon":"Search"},null,8,["modelValue"]),l(F,{modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=a=>E.value=a),placeholder:"题型",clearable:"",style:{width:"120px","margin-left":"12px"}},{default:t(()=>[l(k,{label:"单选题",value:"single_choice"}),l(k,{label:"简答题",value:"short_answer"}),l(k,{label:"报告题",value:"report"})]),_:1},8,["modelValue"])]),Re((c(),_(ke,{data:Z.value,style:{width:"100%"},stripe:""},{default:t(()=>[l(N,{prop:"questionType",label:"题型",width:"100"},{default:t(a=>[l(G,{type:ye(a.row.questionType),effect:"light",round:""},{default:t(()=>[r(m(_e(a.row.questionType)),1)]),_:2},1032,["type"])]),_:1}),l(N,{prop:"prompt",label:"题干内容","min-width":"300"},{default:t(a=>[n("div",al,m(a.row.prompt),1)]),_:1}),l(N,{prop:"difficulty",label:"难度",width:"150"},{default:t(a=>[l(ae,{modelValue:a.row.difficultyVal,"onUpdate:modelValue":C=>a.row.difficultyVal=C,disabled:"","text-color":"#ff9900",max:3,texts:["简单","中等","困难"],"show-text":""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(N,{label:"操作",width:"180",fixed:"right"},{default:t(a=>[l(d,{size:"small",type:"primary",plain:"",icon:"Edit",onClick:C=>we(a.row)},{default:t(()=>[...e[28]||(e[28]=[r("编辑",-1)])]),_:1},8,["onClick"]),l(d,{size:"small",type:"danger",plain:"",icon:"Delete",onClick:C=>he(a.row)},{default:t(()=>[...e[29]||(e[29]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ee,L.value]]),n("div",ol,[l(Ie,{background:"",layout:"prev, pager, next",total:Z.value.length,"page-size":10},null,8,["total"])])]),_:1}),l(oe,{name:"papers"},{label:t(()=>[n("span",sl,[l(v,null,{default:t(()=>[l(U($e))]),_:1}),e[30]||(e[30]=r(" 组卷记录 ",-1))])]),default:t(()=>[l(qe,{description:"暂无组卷记录","image-size":200})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(ne,{modelValue:I.value,"onUpdate:modelValue":e[11]||(e[11]=a=>I.value=a),title:"录入新试题",width:"650px","destroy-on-close":"","align-center":""},{footer:t(()=>[n("span",il,[l(d,{onClick:e[10]||(e[10]=a=>I.value=!1)},{default:t(()=>[...e[33]||(e[33]=[r("取消",-1)])]),_:1}),l(d,{type:"primary",onClick:ve,loading:O.value},{default:t(()=>[...e[34]||(e[34]=[r("保存试题",-1)])]),_:1},8,["loading"])])]),default:t(()=>[l(Y,{model:s.value,"label-width":"100px",ref:"questionFormRef"},{default:t(()=>[l(H,{gutter:20},{default:t(()=>[l(x,{span:12},{default:t(()=>[l(V,{label:"题型"},{default:t(()=>[l(F,{modelValue:s.value.questionType,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.questionType=a),placeholder:"请选择题型",style:{width:"100%"}},{default:t(()=>[l(k,{label:"单选题",value:"single_choice"}),l(k,{label:"简答题",value:"short_answer"}),l(k,{label:"报告题",value:"report"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(x,{span:12},{default:t(()=>[l(V,{label:"难度"},{default:t(()=>[l(ae,{modelValue:s.value.difficultyLevel,"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.difficultyLevel=a),max:3,texts:["简单","中等","困难"],"show-text":""},null,8,["modelValue"]),ee.value?(c(),_(G,{key:0,type:"info",style:{"margin-left":"10px"}},{default:t(()=>[r("建议："+m(ee.value),1)]),_:1})):y("",!0)]),_:1})]),_:1})]),_:1}),l(V,{label:"题干内容"},{default:t(()=>[l(g,{type:"textarea",modelValue:s.value.prompt,"onUpdate:modelValue":e[6]||(e[6]=a=>s.value.prompt=a),rows:4,placeholder:"请输入题目详细描述..."},null,8,["modelValue"])]),_:1}),l(V,{label:"关联知识点"},{default:t(()=>[l(se,{modelValue:s.value.kpIds,"onUpdate:modelValue":e[7]||(e[7]=a=>s.value.kpIds=a),options:h.value,props:{multiple:!0,emitPath:!1,label:"label",value:"id"},"collapse-tags":"","collapse-tags-tooltip":"",clearable:"",filterable:"",placeholder:"请选择关联的知识点",style:{width:"100%"}},null,8,["modelValue","options"])]),_:1}),s.value.questionType==="single_choice"?(c(),T("div",nl,[e[32]||(e[32]=n("div",{class:"block-title"},"选项设置",-1)),(c(!0),T(ie,null,de(s.value.options,(a,C)=>(c(),T("div",{key:C,class:"option-row"},[l(Ue,{modelValue:s.value.correctOptionIndex,"onUpdate:modelValue":e[8]||(e[8]=P=>s.value.correctOptionIndex=P),label:C,class:"correct-radio"},{default:t(()=>[n("span",ul,m(String.fromCharCode(65+C))+".",1)]),_:2},1032,["modelValue","label"]),l(g,{modelValue:a.text,"onUpdate:modelValue":P=>a.text=P,placeholder:"选项内容",style:{flex:"1"}},null,8,["modelValue","onUpdate:modelValue"]),s.value.options.length>2?(c(),_(d,{key:0,type:"danger",icon:"Delete",circle:"",plain:"",size:"small",onClick:P=>fe(C),style:{"margin-left":"10px"}},null,8,["onClick"])):y("",!0)]))),128)),l(d,{type:"primary",plain:"",icon:"Plus",onClick:me,style:{"margin-top":"10px",width:"100%"}},{default:t(()=>[...e[31]||(e[31]=[r("添加选项",-1)])]),_:1})])):y("",!0),s.value.questionType!=="single_choice"?(c(),_(V,{key:1,label:"AI批改",style:{"margin-top":"20px"}},{default:t(()=>[l(Ae,{modelValue:s.value.supportsAiGrading,"onUpdate:modelValue":e[9]||(e[9]=a=>s.value.supportsAiGrading=a),"active-text":"启用自动批改","inactive-text":"仅人工批改"},null,8,["modelValue"])]),_:1})):y("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(ne,{modelValue:q.value,"onUpdate:modelValue":e[22]||(e[22]=a=>q.value=a),title:"智能组卷向导",width:"700px","align-center":"","destroy-on-close":""},{footer:t(()=>[n("span",gl,[f.value>0?(c(),_(d,{key:0,onClick:e[19]||(e[19]=a=>f.value--)},{default:t(()=>[...e[38]||(e[38]=[r("上一步",-1)])]),_:1})):y("",!0),f.value===0?(c(),_(d,{key:1,onClick:e[20]||(e[20]=a=>q.value=!1)},{default:t(()=>[...e[39]||(e[39]=[r("取消",-1)])]),_:1})):y("",!0),f.value<2?(c(),_(d,{key:2,type:"primary",onClick:e[21]||(e[21]=a=>f.value++)},{default:t(()=>[...e[40]||(e[40]=[r("下一步",-1)])]),_:1})):y("",!0),f.value===2?(c(),_(d,{key:3,type:"success",onClick:Ve,loading:R.value,icon:"Checked"},{default:t(()=>[...e[41]||(e[41]=[r("确认生成",-1)])]),_:1},8,["loading"])):y("",!0)])]),default:t(()=>[l(Qe,{active:f.value,"finish-status":"success",simple:"",class:"paper-steps"},{default:t(()=>[l(J,{title:"基本信息",icon:"Edit"}),l(J,{title:"策略配置",icon:"SetUp"}),l(J,{title:"预览发布",icon:"View"})]),_:1},8,["active"]),n("div",dl,[f.value===0?(c(),_(Y,{key:0,model:i.value,"label-width":"100px"},{default:t(()=>[l(V,{label:"试卷标题",required:""},{default:t(()=>[l(g,{modelValue:i.value.title,"onUpdate:modelValue":e[12]||(e[12]=a=>i.value.title=a),placeholder:"例如：2025春季期中测试卷 A",size:"large"},null,8,["modelValue"])]),_:1}),l(V,{label:"目标班级",required:""},{default:t(()=>[l(F,{modelValue:i.value.classId,"onUpdate:modelValue":e[13]||(e[13]=a=>i.value.classId=a),placeholder:"请选择发布班级",style:{width:"100%"},size:"large"},{default:t(()=>[(c(!0),T(ie,null,de(M.value,a=>(c(),_(k,{key:a.classId,label:a.className,value:a.classId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(V,{label:"覆盖知识点"},{default:t(()=>[l(se,{modelValue:i.value.kpIds,"onUpdate:modelValue":e[14]||(e[14]=a=>i.value.kpIds=a),options:h.value,props:{multiple:!0,emitPath:!1,label:"label",value:"id"},"collapse-tags":"","collapse-tags-tooltip":"",clearable:"",filterable:"",placeholder:"选择主要考察的知识点",style:{width:"100%"}},null,8,["modelValue","options"])]),_:1})]),_:1},8,["model"])):y("",!0),f.value===1?(c(),_(Y,{key:1,model:i.value,"label-width":"100px"},{default:t(()=>[l(V,{label:"整体难度"},{default:t(()=>[l(De,{modelValue:i.value.difficulty,"onUpdate:modelValue":e[15]||(e[15]=a=>i.value.difficulty=a),min:1,max:5,"show-input":"",marks:{1:"入门",3:"中等",5:"挑战"}},null,8,["modelValue"])]),_:1}),n("div",rl,[l(H,{gutter:20},{default:t(()=>[l(x,{span:8},{default:t(()=>[n("div",pl,[e[35]||(e[35]=n("div",{class:"count-label"},"单选题",-1)),l(K,{modelValue:i.value.singleChoiceCount,"onUpdate:modelValue":e[16]||(e[16]=a=>i.value.singleChoiceCount=a),min:0},null,8,["modelValue"])])]),_:1}),l(x,{span:8},{default:t(()=>[n("div",cl,[e[36]||(e[36]=n("div",{class:"count-label"},"多选题",-1)),l(K,{modelValue:i.value.multiChoiceCount,"onUpdate:modelValue":e[17]||(e[17]=a=>i.value.multiChoiceCount=a),min:0},null,8,["modelValue"])])]),_:1}),l(x,{span:8},{default:t(()=>[n("div",ml,[e[37]||(e[37]=n("div",{class:"count-label"},"主观题",-1)),l(K,{modelValue:i.value.subjectiveCount,"onUpdate:modelValue":e[18]||(e[18]=a=>i.value.subjectiveCount=a),min:0},null,8,["modelValue"])])]),_:1})]),_:1})])]),_:1},8,["model"])):y("",!0),f.value===2?(c(),T("div",fl,[n("div",vl,[n("h3",null,m(i.value.title||"未命名试卷"),1),n("div",_l,[l(G,null,{default:t(()=>[r("总题数: "+m(le.value),1)]),_:1}),l(G,{type:"warning"},{default:t(()=>[r("预估时长: "+m(le.value*3)+" 分钟",1)]),_:1})]),l(Me,{"border-style":"dashed"}),n("div",yl,[n("p",null,[l(v,null,{default:t(()=>[l(U(ue))]),_:1}),r(" 包含单选 "+m(i.value.singleChoiceCount)+" 题，多选 "+m(i.value.multiChoiceCount)+" 题，主观 "+m(i.value.subjectiveCount)+" 题",1)]),n("p",null,[l(v,null,{default:t(()=>[l(U(je))]),_:1}),r(" 难度系数: "+m(i.value.difficulty)+"/5",1)])]),l(Se,{title:"AI 将根据所选知识点图谱关联度自动抽取最优题目组合",type:"success","show-icon":"",closable:!1,class:"ai-alert"})])])):y("",!0)])]),_:1},8,["modelValue"])])}}},kl=ze(bl,[["__scopeId","data-v-3355d503"]]);export{kl as default};
