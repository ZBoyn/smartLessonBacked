import{_ as j,u as A,r as I,k as L,l as O,E as v,j as l,o as a,g as W,s as z,a as k,w as r,b as c,d as G,q as T,F as x,m as b,f as u,t as m,e as d,h as y,x as H}from"./index-BotqV5dR.js";import{s as h}from"./request-BUaFPsLP.js";const J={class:"exam-page"},K={class:"paper-header"},Q={class:"title-section"},X={key:0,class:"timer"},Y={key:0,class:"questions-container"},Z={class:"q-title"},ee={class:"q-index"},se={class:"q-type"},te={class:"q-prompt"},oe={key:0,class:"q-body"},ae={key:1,class:"q-body"},ne={key:0,class:"upload-section"},le={__name:"StudentAssessment",setup(re){const V=A(),q=G(),_=V.params.assessmentId,w=I(!1),p=I({}),t=L({});O(async()=>{if(_){w.value=!0;try{const e=await h.get(`/student/assessments/${_}`);p.value=e,e.questions.forEach(s=>{t[s.questionId]={type:s.questionType,value:null,file:null}})}catch(e){console.error(e),v.error("获取试卷失败")}finally{w.value=!1}}});const D=e=>e?new Date(e).toLocaleString():"无限制",B=e=>({single_choice:"单选题",report:"简答/报告",short_answer:"简答题"})[e]||e,C=async(e,s)=>{const{file:g}=e,f=new FormData;f.append("file",g);try{const i=await h.post(`/student/assessments/${_}/answers/${s}/upload`,f,{headers:{"Content-Type":"multipart/form-data"}});t[s].file=i.url||i.filePath,v.success("上传成功")}catch(i){console.error(i),v.error("上传失败")}},E=e=>{t[e].file=null},F=async()=>{try{await H.confirm("确定要提交试卷吗？提交后无法修改。","提示",{confirmButtonText:"提交",cancelButtonText:"取消",type:"warning"});const e={answers:Object.keys(t).map(s=>({questionId:parseInt(s),answerText:typeof t[s].value=="string"?t[s].value:null,optionId:typeof t[s].value=="number"?t[s].value:null}))};await h.post(`/student/assessments/${_}/answers`,e),await h.post(`/student/assessments/${_}/submit`),v.success("提交成功！"),q.push("/student/assessments")}catch(e){e!=="cancel"&&(console.error(e),v.error("提交失败"))}};return(e,s)=>{const g=c("Timer"),f=c("el-icon"),i=c("el-button"),U=c("el-radio"),$=c("el-radio-group"),N=c("el-input"),S=c("el-upload"),M=c("el-card"),P=z("loading");return a(),l("div",J,[W((a(),k(M,{class:"paper-card"},{header:r(()=>[u("div",K,[u("div",Q,[u("h2",null,m(p.value.title),1),p.value.endTime?(a(),l("p",X,[d(f,null,{default:r(()=>[d(g)]),_:1}),y(" 截止时间: "+m(D(p.value.endTime)),1)])):T("",!0)]),d(i,{type:"primary",onClick:F},{default:r(()=>[...s[0]||(s[0]=[y("提交试卷",-1)])]),_:1})])]),default:r(()=>[p.value.questions?(a(),l("div",Y,[(a(!0),l(x,null,b(p.value.questions,(o,R)=>(a(),l("div",{key:o.questionId,class:"question-item"},[u("div",Z,[u("span",ee,m(R+1)+".",1),u("span",se,"["+m(B(o.questionType))+"]",1),u("span",te,m(o.prompt),1)]),o.questionType==="single_choice"?(a(),l("div",oe,[d($,{modelValue:t[o.questionId].value,"onUpdate:modelValue":n=>t[o.questionId].value=n},{default:r(()=>[(a(!0),l(x,null,b(o.options,n=>(a(),k(U,{key:n.optionId,label:n.optionId,class:"option-item"},{default:r(()=>[y(m(n.optionText),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(a(),l("div",ae,[d(N,{modelValue:t[o.questionId].value,"onUpdate:modelValue":n=>t[o.questionId].value=n,type:"textarea",rows:6,placeholder:"请输入您的答案..."},null,8,["modelValue","onUpdate:modelValue"]),o.questionType==="report"?(a(),l("div",ne,[d(S,{class:"upload-demo",action:"#","http-request":n=>C(n,o.questionId),limit:1,"on-remove":()=>E(o.questionId)},{default:r(()=>[d(i,{type:"primary",link:""},{default:r(()=>[...s[1]||(s[1]=[y("上传附件 (PDF/Word)",-1)])]),_:1})]),_:1},8,["http-request","on-remove"])])):T("",!0)]))]))),128))])):T("",!0)]),_:1})),[[P,w.value]])])}}},ue=j(le,[["__scopeId","data-v-69316259"]]);export{ue as default};
