import{_ as ve,u as ge,r as g,l as fe,c as F,j as i,o as n,f as a,e as l,w as o,b as d,g as E,t as u,s as ye,F as f,h as c,z,W as he,m as b,a as be,n as ke,q as k,X as Ie,Y as Ve,v as xe,E as y}from"./index-BotqV5dR.js";import{e as R}from"./modules-CiYeg_KF.js";import"./request-BUaFPsLP.js";const Se={class:"grading-view"},Re={class:"top-bar"},Ce={class:"left"},Ae={class:"right"},De={class:"main-layout"},Ne={class:"list-panel"},we={class:"panel-header"},Te=["onClick"],$e={class:"s-avatar"},Me={class:"s-info"},ze={class:"s-name"},Ue={class:"s-id"},qe={class:"s-status"},Ge={key:0,class:"s-score"},Je={class:"grading-panel"},Pe={class:"grading-header"},Be={class:"student-card"},Fe={class:"time"},Ee={class:"actions"},Le={class:"q-index"},Oe={class:"qa-section"},je={class:"q-text"},Qe={class:"a-box"},We={class:"a-content"},Xe={key:0,class:"file-attach"},Ye=["href"],He={class:"grade-section"},Ke={class:"ai-box"},Ze={class:"ai-header"},es={key:0,class:"ai-result"},ss={class:"ai-score"},ts={class:"ai-summary"},ls={key:0,class:"ai-summary"},as={key:1,class:"ai-dims"},os={class:"dim-name"},ns={key:1,class:"ai-placeholder"},is={class:"manual-box"},ds={key:0},us={class:"dim-name"},rs={key:1,class:"empty-selection"},cs={__name:"GradingView",setup(ms){const C=ge().params.assessmentId,A=g(!1),m=g([]),I=g("all"),_=g(null),D=g({}),V=g([]),x=g("__all"),N=g(.6),w=g(!1),S=g({title:"",dims:[]}),L=[{submissionId:1,studentName:"张三",studentId:"2021001",submitTime:"2025-11-20T10:30:00",status:"submitted",score:null,answers:[{answerId:101,questionPrompt:"请简述 Spring Boot 的核心特性。",type:"short_answer",answerText:"Spring Boot 提供了自动配置、起步依赖、Actuator 等特性，大大简化了 Spring 应用的开发。",score:null,feedback:"",aiResult:null},{answerId:102,questionPrompt:"什么是 Java 内存模型 (JMM)？",type:"short_answer",answerText:"JMM 是一种抽象的概念，描述了 Java 程序中各种变量（线程共享变量）的访问规则。",score:null,feedback:"",aiResult:null}]},{submissionId:2,studentName:"李四",studentId:"2021002",submitTime:"2025-11-20T11:00:00",status:"graded",score:85,answers:[]}],O=async()=>{A.value=!0;try{const t=await R.getSubmissions(C);m.value=t||[];const s=await R.getAiFeedbackSummary(C);V.value=s||[]}catch{console.log("Using mock data due to API error"),m.value=L,V.value=[{name:"内容相关性不足",count:6},{name:"结构组织不清晰",count:5},{name:"术语使用不规范",count:3}]}finally{A.value=!1}};fe(()=>{C&&O()});const U=F(()=>I.value==="all"?m.value:m.value.filter(t=>t.status===I.value)),j=F(()=>{if(m.value.length===0)return 0;const t=m.value.filter(s=>s.status==="graded").length;return Math.round(t/m.value.length*100)}),Q=t=>t===100?"完成":`${t}%`,W=t=>{_.value=JSON.parse(JSON.stringify(t))},X=t=>({in_progress:"进行中",submitted:"待批",graded:"已批"})[t]||t,Y=t=>({in_progress:"info",submitted:"warning",graded:"success"})[t]||"info",H=t=>t?new Date(t).toLocaleString():"-",K=async t=>{D.value[t.answerId]=!0;try{const s=await R.aiGrade(t.answerId);t.aiResult=s;try{const r=typeof s.dimensions=="string"?JSON.parse(s.dimensions):s.dimensions||{};t.aiDims=Object.keys(r).map(p=>({name:p,value:Number(r[p])}))}catch{t.aiDims=[]}y.success("AI 分析完成")}catch{const r={totalScore:80,summary:"系统暂未返回，使用本地分析结果。",suggestions:""};t.aiResult=r,t.aiDims=[],y.warning("AI 服务不可用，已使用本地结果")}finally{D.value[t.answerId]=!1}},Z=t=>{t.aiResult&&(t.score=t.aiResult.totalScore,t.feedback=`[AI点评] ${t.aiResult.summary}
建议: ${t.aiResult.suggestions}`)},ee=()=>{if(_.value){for(const t of _.value.answers||[])t.aiResult&&(t.score=t.aiResult.totalScore,t.feedback=`[AI点评] ${t.aiResult.summary}
建议: ${t.aiResult.suggestions||""}`);y.success("已批量采纳 AI 评分")}},se=t=>x.value==="__all"?!0:(t.aiDims||[]).some(r=>r.name===x.value&&(r.value||0)<N.value),te=async t=>{try{await R.manualGrade(t.answerId,{score:t.score,feedback:t.feedback}),y.success("保存成功");const s=m.value.findIndex(r=>r.submissionId===_.value.submissionId);s!==-1&&(m.value[s].status="graded")}catch{y.success("保存成功 (Mock)");const r=m.value.findIndex(p=>p.submissionId===_.value.submissionId);r!==-1&&(m.value[r].status="graded",m.value[r].score=85)}},le=()=>{y.success("批改完成，已通知学生"),_.value=null};return(t,s)=>{const r=d("el-icon"),p=d("el-button"),T=d("el-progress"),h=d("el-option"),q=d("el-select"),ae=d("el-slider"),$=d("el-tag"),G=d("el-scrollbar"),J=d("el-col"),oe=d("el-input-number"),P=d("el-form-item"),ne=d("el-input"),ie=d("el-form"),de=d("el-row"),ue=d("el-divider"),B=d("el-table-column"),re=d("el-table"),ce=d("el-card"),me=d("el-dialog"),_e=d("el-empty"),pe=ye("loading");return n(),i("div",Se,[a("div",Re,[a("div",Ce,[l(p,{link:"",onClick:s[0]||(s[0]=e=>t.$router.back())},{default:o(()=>[l(r,null,{default:o(()=>[l(z(he))]),_:1}),s[6]||(s[6]=c(" 返回列表 ",-1))]),_:1}),s[7]||(s[7]=a("span",{class:"divider"},"|",-1)),s[8]||(s[8]=a("span",{class:"title"},"智能批改工作台",-1))]),a("div",Ae,[l(T,{percentage:j.value,format:Q,style:{width:"200px","margin-right":"20px"}},null,8,["percentage"]),l(q,{modelValue:x.value,"onUpdate:modelValue":s[1]||(s[1]=e=>x.value=e),placeholder:"错误维度筛选",size:"small",style:{width:"160px","margin-right":"12px"}},{default:o(()=>[l(h,{label:"全部维度",value:"__all"}),(n(!0),i(f,null,b(V.value,e=>(n(),be(h,{key:e.name,label:e.name+" ("+e.count+")",value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(q,{modelValue:I.value,"onUpdate:modelValue":s[2]||(s[2]=e=>I.value=e),placeholder:"状态筛选",size:"small",style:{width:"120px"}},{default:o(()=>[l(h,{label:"全部",value:"all"}),l(h,{label:"待批改",value:"in_progress"}),l(h,{label:"已完成",value:"graded"})]),_:1},8,["modelValue"]),l(p,{type:"success",plain:"",size:"small",style:{"margin-left":"12px"},onClick:ee},{default:o(()=>[...s[9]||(s[9]=[c("批量采纳AI评分",-1)])]),_:1}),l(ae,{modelValue:N.value,"onUpdate:modelValue":s[3]||(s[3]=e=>N.value=e),min:0,max:1,step:.05,style:{width:"160px","margin-left":"12px"}},null,8,["modelValue"])])]),a("div",De,[a("div",Ne,[a("div",we,"提交列表 ("+u(U.value.length)+")",1),l(G,null,{default:o(()=>[(n(!0),i(f,null,b(U.value,e=>(n(),i("div",{key:e.submissionId,class:ke(["student-item",{active:_.value&&_.value.submissionId===e.submissionId}]),onClick:M=>W(e)},[a("div",$e,u(e.studentName?e.studentName[0]:"S"),1),a("div",Me,[a("div",ze,u(e.studentName),1),a("div",Ue,u(e.studentId),1)]),a("div",qe,[l($,{size:"small",type:Y(e.status),effect:"dark"},{default:o(()=>[c(u(X(e.status)),1)]),_:2},1032,["type"]),e.score!=null?(n(),i("div",Ge,u(e.score)+"分",1)):k("",!0)])],10,Te))),128))]),_:1})]),E((n(),i("div",Je,[_.value?(n(),i(f,{key:0},[a("div",Pe,[a("div",Be,[a("h2",null,u(_.value.studentName)+" 的作业",1),a("span",Fe,"提交时间: "+u(H(_.value.submitTime)),1)]),a("div",Ee,[l(p,{type:"primary",onClick:le,icon:"Check"},{default:o(()=>[...s[10]||(s[10]=[c("完成批改",-1)])]),_:1})])]),l(G,{class:"grading-content"},{default:o(()=>[(n(!0),i(f,null,b(_.value.answers,(e,M)=>E((n(),i("div",{key:M,class:"question-block"},[a("div",Le,"Q"+u(M+1),1),l(de,{gutter:20},{default:o(()=>[l(J,{span:14},{default:o(()=>[a("div",Oe,[a("div",je,[l($,{size:"small",effect:"plain"},{default:o(()=>[c(u(e.type||"简答题"),1)]),_:2},1024),c(" "+u(e.questionPrompt),1)]),a("div",Qe,[s[11]||(s[11]=a("div",{class:"a-label"},"学生作答:",-1)),a("div",We,u(e.answerText),1),e.filePath?(n(),i("div",Xe,[l(r,null,{default:o(()=>[l(z(Ie))]),_:1}),a("a",{href:e.filePath,target:"_blank"},"查看附件",8,Ye)])):k("",!0)])])]),_:2},1024),l(J,{span:10},{default:o(()=>[a("div",He,[a("div",Ke,[a("div",Ze,[a("span",null,[l(r,null,{default:o(()=>[l(z(Ve))]),_:1}),s[12]||(s[12]=c(" AI 辅助批改",-1))]),l(p,{type:"primary",link:"",loading:D.value[e.answerId],onClick:v=>K(e)},{default:o(()=>[c(u(e.aiResult?"重新分析":"开始分析"),1)]),_:2},1032,["loading","onClick"])]),e.aiResult?(n(),i("div",es,[a("div",ss,[s[13]||(s[13]=c("建议得分: ",-1)),a("span",null,u(e.aiResult.totalScore),1)]),a("div",ts,u(e.aiResult.summary),1),e.aiResult.suggestions?(n(),i("div",ls,"建议："+u(e.aiResult.suggestions),1)):k("",!0),e.aiDims&&e.aiDims.length?(n(),i("div",as,[(n(!0),i(f,null,b(e.aiDims,v=>(n(),i("div",{class:"dim-item",key:v.name},[a("span",os,u(v.name),1),l(T,{percentage:Math.round((v.value||0)*100),color:t.getColor,"stroke-width":12},null,8,["percentage","color"])]))),128))])):k("",!0),l(p,{type:"success",plain:"",size:"small",style:{width:"100%","margin-top":"10px"},onClick:v=>Z(e)},{default:o(()=>[...s[14]||(s[14]=[c("采纳 AI 评分与评语",-1)])]),_:1},8,["onClick"])])):(n(),i("div",ns," 点击“开始分析”获取 AI 评分建议 "))]),a("div",is,[l(ie,{"label-position":"top"},{default:o(()=>[l(P,{label:"得分"},{default:o(()=>[l(oe,{modelValue:e.score,"onUpdate:modelValue":v=>e.score=v,min:0,max:100,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(P,{label:"教师评语"},{default:o(()=>[l(ne,{modelValue:e.feedback,"onUpdate:modelValue":v=>e.feedback=v,type:"textarea",rows:3,placeholder:"请输入评语..."},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(p,{type:"primary",plain:"",size:"small",onClick:v=>te(e),style:{float:"right"}},{default:o(()=>[...s[15]||(s[15]=[c("保存本题",-1)])]),_:1},8,["onClick"])]),_:2},1024)])])]),_:2},1024)]),_:2},1024),l(ue)])),[[xe,se(e)]])),128))]),_:1}),l(ce,{class:"list-card",shadow:"hover",style:{margin:"20px"}},{header:o(()=>[...s[16]||(s[16]=[a("div",{class:"card-header"},[a("span",null,"典型错误模式 Top5")],-1)])]),default:o(()=>[l(re,{data:V.value,style:{width:"100%"},"show-header":!1},{default:o(()=>[l(B,{prop:"name"}),l(B,{prop:"count",width:"120",align:"right"},{default:o(e=>[l($,{type:"danger"},{default:o(()=>[c(u(e.row.count),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1}),l(me,{modelValue:w.value,"onUpdate:modelValue":s[5]||(s[5]=e=>w.value=e),title:"维度明细",width:"600px","align-center":""},{footer:o(()=>[l(p,{onClick:s[4]||(s[4]=e=>w.value=!1)},{default:o(()=>[...s[17]||(s[17]=[c("关闭",-1)])]),_:1})]),default:o(()=>[S.value&&S.value.dims&&S.value.dims.length?(n(),i("div",ds,[(n(!0),i(f,null,b(S.value.dims,e=>(n(),i("div",{class:"dim-item",key:e.name},[a("span",us,u(e.name),1),l(T,{percentage:Math.round((e.value||0)*100),color:t.getColor,"stroke-width":12},null,8,["percentage","color"])]))),128))])):k("",!0)]),_:1},8,["modelValue"])],64)):(n(),i("div",rs,[l(_e,{description:"请从左侧选择一名学生进行批改"})]))])),[[pe,A.value]])])])}}},fs=ve(cs,[["__scopeId","data-v-28fa6840"]]);export{fs as default};
