import{_ as de,u as ie,r as m,c as I,l as ue,j as y,o as i,f as n,e as t,w as l,b as o,d as re,s as ce,F as me,m as pe,a as b,h as u,t as r,g as _e,z as w,Q as fe,R as ve,S as ge,U as ye,V as be,x as we,E as V}from"./index-BotqV5dR.js";import{a as he,d as X}from"./modules-CiYeg_KF.js";import"./request-BUaFPsLP.js";const Te={class:"page-container"},ke={class:"page-header"},Ce={class:"header-controls"},Ie={class:"stat-card"},Ve={class:"stat-value"},xe={class:"stat-card"},Ae={class:"stat-value warning"},Me={class:"stat-card"},Re={class:"stat-value"},De={class:"title-cell"},Ee={class:"name"},Be={class:"meta"},Se={key:0,class:"time-info"},Ue={key:1,class:"draft-tip"},Ge={key:1},Ne={class:"actions"},Le={__name:"AiGrading",setup(Xe){const E=re(),h=ie().params.courseId,x=m(!1),p=m(!1),A=m(!1),c=m([]),M=m([]),_=m(null),T=m("all"),d=m({id:null,startTime:"",endTime:""}),$=I(()=>c.value.filter(a=>a.status==="published").length),z=I(()=>12),F=I(()=>3),P=I(()=>T.value==="all"?c.value:c.value.filter(a=>a.status===T.value));ue(async()=>{await O()});const O=async()=>{if(h)try{const a=await he.getClassesByCourse(h);M.value=a,a&&a.length>0&&(_.value=a[0].classId,k())}catch(a){console.error(a),M.value=[{classId:1,className:"软件1班"}],_.value=1,k()}},k=async()=>{if(_.value){x.value=!0;try{const a=await X.getAssessmentsByClass(_.value);c.value=a.map(e=>({...e,completionRate:Math.floor(Math.random()*100)}))}catch(a){console.error(a),c.value=[{assessmentId:1,title:"期中考试",assessmentType:"EXAM",status:"published",startTime:"2025-11-20 10:00",endTime:"2025-11-20 12:00",completionRate:85},{assessmentId:2,title:"第三章课后作业",assessmentType:"HOMEWORK",status:"draft",startTime:null,endTime:null,completionRate:0},{assessmentId:3,title:"Java基础测验",assessmentType:"EXAM",status:"closed",startTime:"2025-10-10 09:00",endTime:"2025-10-10 11:00",completionRate:100}]}finally{x.value=!1}}},Q=a=>({draft:"草稿",published:"进行中",closed:"已结束"})[a]||a,B=a=>({draft:"info",published:"success",closed:"warning"})[a]||"info",S=a=>a?new Date(a).toLocaleString():"-",j=()=>{E.push({name:"SmartQuestions",params:{courseId:h}}),V.info("请先在智能题库中生成试卷")},H=a=>{d.value.id=a.assessmentId,p.value=!0},J=async()=>{A.value=!0;try{await X.publishAssessment(d.value.id,{startTime:d.value.startTime,endTime:d.value.endTime}),V.success("发布成功"),p.value=!1,k()}catch{V.success("发布成功 (Mock)"),p.value=!1;const e=c.value.find(R=>R.assessmentId===d.value.id);e&&(e.status="published",e.startTime=d.value.startTime,e.endTime=d.value.endTime)}finally{A.value=!1}},K=a=>{we.confirm("确认删除该测评吗？","提示",{type:"warning"}).then(()=>{V.success("删除成功"),c.value=c.value.filter(e=>e.assessmentId!==a.assessmentId)})},W=a=>{E.push({name:"AssessmentGrading",params:{courseId:h,assessmentId:a}})};return(a,e)=>{const R=o("el-option"),q=o("el-select"),f=o("el-button"),D=o("el-col"),Y=o("el-row"),C=o("el-tab-pane"),Z=o("el-tabs"),v=o("el-table-column"),U=o("el-tag"),ee=o("el-badge"),g=o("el-icon"),te=o("el-progress"),se=o("el-table"),le=o("el-card"),G=o("el-date-picker"),N=o("el-form-item"),ae=o("el-form"),ne=o("el-dialog"),oe=ce("loading");return i(),y("div",Te,[n("div",ke,[e[7]||(e[7]=n("div",null,[n("h2",null,"测评与批改管理"),n("p",{class:"subtitle"},"发布考试/作业，监控提交进度，进行智能批改")],-1)),n("div",Ce,[t(q,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=s=>_.value=s),placeholder:"选择班级",onChange:k,size:"large",style:{width:"200px"}},{default:l(()=>[(i(!0),y(me,null,pe(M.value,s=>(i(),b(R,{key:s.classId,label:s.className,value:s.classId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(f,{type:"primary",icon:"Plus",size:"large",onClick:j,style:{"margin-left":"12px"}},{default:l(()=>[...e[6]||(e[6]=[u("新建测评",-1)])]),_:1})])]),t(Y,{gutter:20,style:{"margin-bottom":"20px"}},{default:l(()=>[t(D,{span:6},{default:l(()=>[n("div",Ie,[e[8]||(e[8]=n("div",{class:"stat-title"},"进行中测评",-1)),n("div",Ve,r($.value),1)])]),_:1}),t(D,{span:6},{default:l(()=>[n("div",xe,[e[9]||(e[9]=n("div",{class:"stat-title"},"待批改份数",-1)),n("div",Ae,r(z.value),1)])]),_:1}),t(D,{span:6},{default:l(()=>[n("div",Me,[e[10]||(e[10]=n("div",{class:"stat-title"},"本周发布",-1)),n("div",Re,r(F.value),1)])]),_:1})]),_:1}),t(le,{shadow:"never",class:"table-card"},{default:l(()=>[t(Z,{modelValue:T.value,"onUpdate:modelValue":e[1]||(e[1]=s=>T.value=s)},{default:l(()=>[t(C,{label:"全部测评",name:"all"}),t(C,{label:"进行中",name:"published"}),t(C,{label:"草稿箱",name:"draft"}),t(C,{label:"已结束",name:"closed"})]),_:1},8,["modelValue"]),_e((i(),b(se,{data:P.value,style:{width:"100%"},"header-cell-style":{background:"#f5f7fa"}},{default:l(()=>[t(v,{prop:"title",label:"测评名称","min-width":"200"},{default:l(s=>[n("div",De,[n("div",Ee,r(s.row.title),1),n("div",Be,"ID: "+r(s.row.assessmentId),1)])]),_:1}),t(v,{prop:"assessmentType",label:"类型",width:"100"},{default:l(s=>[t(U,{type:s.row.assessmentType==="EXAM"?"danger":"primary",effect:"plain"},{default:l(()=>[u(r(s.row.assessmentType==="EXAM"?"考试":"作业"),1)]),_:2},1032,["type"])]),_:1}),t(v,{prop:"status",label:"状态",width:"120"},{default:l(s=>[t(ee,{"is-dot":"",type:B(s.row.status),class:"status-badge"},{default:l(()=>[t(U,{type:B(s.row.status),effect:"light",round:""},{default:l(()=>[u(r(Q(s.row.status)),1)]),_:2},1032,["type"])]),_:2},1032,["type"])]),_:1}),t(v,{label:"时间安排",width:"300"},{default:l(s=>[s.row.status!=="draft"?(i(),y("div",Se,[n("div",null,[t(g,null,{default:l(()=>[t(w(fe))]),_:1}),u(" 开始: "+r(S(s.row.startTime)),1)]),n("div",null,[t(g,null,{default:l(()=>[t(w(ve))]),_:1}),u(" 结束: "+r(S(s.row.endTime)),1)])])):(i(),y("div",Ue,"未发布"))]),_:1}),t(v,{label:"完成度",width:"150"},{default:l(s=>[s.row.status!=="draft"?(i(),b(te,{key:0,percentage:s.row.completionRate||0,status:s.row.completionRate===100?"success":""},null,8,["percentage","status"])):(i(),y("span",Ge,"-"))]),_:1}),t(v,{label:"操作",width:"200",fixed:"right"},{default:l(s=>[n("div",Ne,[s.row.status==="draft"?(i(),b(f,{key:0,type:"success",link:"",onClick:L=>H(s.row)},{default:l(()=>[t(g,null,{default:l(()=>[t(w(ge))]),_:1}),e[11]||(e[11]=u(" 发布 ",-1))]),_:1},8,["onClick"])):(i(),b(f,{key:1,type:"primary",link:"",onClick:L=>W(s.row.assessmentId)},{default:l(()=>[t(g,null,{default:l(()=>[t(w(ye))]),_:1}),e[12]||(e[12]=u(" 批改 ",-1))]),_:1},8,["onClick"])),t(f,{type:"danger",link:"",onClick:L=>K(s.row)},{default:l(()=>[t(g,null,{default:l(()=>[t(w(be))]),_:1})]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[oe,x.value]])]),_:1}),t(ne,{modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=s=>p.value=s),title:"发布测评",width:"500px"},{footer:l(()=>[t(f,{onClick:e[4]||(e[4]=s=>p.value=!1)},{default:l(()=>[...e[13]||(e[13]=[u("取消",-1)])]),_:1}),t(f,{type:"primary",onClick:J,loading:A.value},{default:l(()=>[...e[14]||(e[14]=[u("确认发布",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(ae,{model:d.value,"label-width":"80px"},{default:l(()=>[t(N,{label:"开始时间"},{default:l(()=>[t(G,{modelValue:d.value.startTime,"onUpdate:modelValue":e[2]||(e[2]=s=>d.value.startTime=s),type:"datetime",placeholder:"选择开始时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(N,{label:"截止时间"},{default:l(()=>[t(G,{modelValue:d.value.endTime,"onUpdate:modelValue":e[3]||(e[3]=s=>d.value.endTime=s),type:"datetime",placeholder:"选择截止时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Oe=de(Le,[["__scopeId","data-v-ae167256"]]);export{Oe as default};
