import{_ as Q,u as W,r,l as X,j as h,o as u,f as m,e as o,w as t,b as n,s as Y,h as i,g as Z,a as _,t as P,F as E,m as F,E as c,x as ee}from"./index-BotqV5dR.js";import{r as y,g as le}from"./modules-CiYeg_KF.js";import"./request-BUaFPsLP.js";const te={class:"page-container"},oe={class:"header-actions"},ae={class:"resource-name"},ne={style:{"margin-left":"8px"}},se={class:"dialog-footer"},re={__name:"CourseResources",setup(ue){const w=W().params.courseId,k=r(!1),C=r([]),p=r(!1),b=r(!1),x=r([]),s=r({title:"",kpIds:[]}),D=r([]),f=r(null),V=async()=>{k.value=!0;try{const l=await y.getResources(w);C.value=l}catch(l){console.error(l)}finally{k.value=!1}},U=async()=>{try{const l=await le.getGraph(w);l&&l.nodes&&(x.value=l.nodes.map(e=>({id:e.id,name:e.label})))}catch(l){console.error("加载知识点失败",l)}};X(()=>{V(),U()});const B=l=>{f.value=l.raw},$=async()=>{if(!f.value){c.warning("请选择文件");return}if(s.value.kpIds.length===0){c.warning("请至少关联一个知识点");return}b.value=!0;try{const l=new FormData;l.append("file",f.value),l.append("title",s.value.title),s.value.kpIds.forEach(e=>{l.append("knowledgePointIds",e)}),await y.uploadResource(w,l),c.success("上传成功"),p.value=!1,V(),s.value={title:"",kpIds:[]},D.value=[],f.value=null}catch{c.error("上传失败")}finally{b.value=!1}},T=async l=>{try{await ee.confirm("确认删除该资源吗?","警告",{type:"warning"}),await y.deleteResource(l),c.success("删除成功"),V()}catch{}},L=l=>{const e=y.getDownloadUrl(l.resourceId);c.info(`正在尝试请求资源: ${e}`)};return(l,e)=>{const d=n("el-button"),M=n("VideoPlay"),R=n("el-icon"),N=n("Document"),v=n("el-table-column"),A=n("el-tag"),O=n("el-table"),j=n("el-card"),z=n("el-input"),I=n("el-form-item"),G=n("el-option"),K=n("el-select"),S=n("el-upload"),q=n("el-form"),H=n("el-dialog"),J=Y("loading");return u(),h("div",te,[m("div",oe,[e[6]||(e[6]=m("h3",null,"课程资源库",-1)),o(d,{type:"primary",icon:"Upload",onClick:e[0]||(e[0]=a=>p.value=!0)},{default:t(()=>[...e[5]||(e[5]=[i("上传资源",-1)])]),_:1})]),o(j,null,{default:t(()=>[Z((u(),_(O,{data:C.value,style:{width:"100%"}},{default:t(()=>[o(v,{prop:"title",label:"资源名称","min-width":"200"},{default:t(a=>[m("div",ae,[a.row.resourceType==="VIDEO"?(u(),_(R,{key:0},{default:t(()=>[o(M)]),_:1})):(u(),_(R,{key:1},{default:t(()=>[o(N)]),_:1})),m("span",ne,P(a.row.title),1)])]),_:1}),o(v,{prop:"resourceType",label:"类型",width:"100"}),o(v,{label:"关联知识点","min-width":"200"},{default:t(a=>[(u(!0),h(E,null,F(a.row.knowledgePoints,g=>(u(),_(A,{key:g,size:"small",style:{"margin-right":"5px"}},{default:t(()=>[i(P(g),1)]),_:2},1024))),128))]),_:1}),o(v,{label:"操作",width:"200"},{default:t(a=>[o(d,{link:"",type:"primary",onClick:g=>L(a.row)},{default:t(()=>[...e[7]||(e[7]=[i("预览/下载",-1)])]),_:1},8,["onClick"]),o(d,{link:"",type:"danger",onClick:g=>T(a.row.resourceId)},{default:t(()=>[...e[8]||(e[8]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,k.value]])]),_:1}),o(H,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=a=>p.value=a),title:"上传课程资源",width:"500px"},{footer:t(()=>[m("span",se,[o(d,{onClick:e[3]||(e[3]=a=>p.value=!1)},{default:t(()=>[...e[10]||(e[10]=[i("取消",-1)])]),_:1}),o(d,{type:"primary",onClick:$,loading:b.value},{default:t(()=>[...e[11]||(e[11]=[i("确认上传",-1)])]),_:1},8,["loading"])])]),default:t(()=>[o(q,{model:s.value,"label-width":"80px"},{default:t(()=>[o(I,{label:"资源标题"},{default:t(()=>[o(z,{modelValue:s.value.title,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.title=a),placeholder:"例如：第一章 PPT"},null,8,["modelValue"])]),_:1}),o(I,{label:"关联知识点"},{default:t(()=>[o(K,{modelValue:s.value.kpIds,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.kpIds=a),multiple:"",placeholder:"请选择关联的知识点",style:{width:"100%"}},{default:t(()=>[(u(!0),h(E,null,F(x.value,a=>(u(),_(G,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(I,{label:"文件"},{default:t(()=>[o(S,{class:"upload-demo","auto-upload":!1,limit:1,"on-change":B,"file-list":D.value},{trigger:t(()=>[o(d,{type:"primary"},{default:t(()=>[...e[9]||(e[9]=[i("选择文件",-1)])]),_:1})]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},me=Q(re,[["__scopeId","data-v-cf6280a1"]]);export{me as default};
